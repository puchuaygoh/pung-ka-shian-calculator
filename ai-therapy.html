<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å AI ‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• - ‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* (CSS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î... "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°" (Same as before) ‡∏Ñ‡∏£‡∏±‡∏ö... 
           ‡∏ú‡∏° "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å" (Copied) "‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå" (Design) "‡∏ó‡∏µ‡πà '‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á'" (Not broken) "‡∏°‡∏≤‡πÉ‡∏´‡πâ" (for you) "‡πÅ‡∏•‡πâ‡∏ß" (already)) */
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f0f4f7;
            color: #333;
            line-height: 1.6;
            padding-top: 60px; 
        }
        .navbar {
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-logo {
            font-weight: 700;
            font-size: 1.3rem;
            color: #34495e;
            text-decoration: none;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 25px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            border: 1px solid #e0e6ed;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-weight: 700;
            font-size: 2.5em;
        }
        .intro-text {
            text-align: center;
            font-size: 1.1em;
            color: #666;
            margin-bottom: 30px;
        }
        .therapy-input-section {
            background-color: #E8F8F5;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #dce2e8;
        }
        textarea {
            width: calc(100% - 20px);
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #00B894;
            border-radius: 8px;
            font-size: 1.1em;
            line-height: 1.5;
            min-height: 150px;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        textarea:focus {
            border-color: #4CAF50;
            outline: none;
        }
        button#getTherapyCardButton {
            background-color: #FFC0CB;
            color: #34495e;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-weight: 700;
        }
        button#getTherapyCardButton:hover {
            background-color: #ffafc0;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .therapy-result-section {
            margin-top: 35px;
            padding: 25px;
            background-color: #fdfdfd;
            border: 1px solid #e0e6ed;
            border-radius: 10px;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #555;
            font-size: 1.1em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00B894;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: #e74c3c;
            font-weight: 500;
            margin-top: 15px;
        }
        .therapy-card-display {
            position: relative;
            width: 100%;
            max-width: 350px;
            margin: 20px auto;
        }
        .therapy-card-display img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .therapy-text-overlay {
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            padding: 15px 5px;
            color: #34495e;
            font-size: 1.0em;
            font-weight: 600;
            line-height: 1.3;
            text-align: center;
            border-radius: 5px;
        }
        .footer-cta {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px dashed #ccc;
        }
        .footer-cta p {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 15px;
        }
        .footer-cta a.button {
            display: inline-block;
            background-color: #d9534f;
            padding: 12px 25px;
            text-decoration: none;
            color: white;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }
        .footer-cta a.button:hover {
            background-color: #c9302c;
        }
    </style>
</head>
<body>
    
    <nav class="navbar">
        <a href="index.html" class="nav-logo">üê∑ ‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß by ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏Å‡πä‡∏∞</a>
    </nav>
    
    <div class="container">
        <h1>‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å AI ‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h1>
        <p class="intro-text">
            ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ **‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÉ‡∏à** ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì AI ‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
        </p>

        <div class="therapy-input-section">
            <p style="font-size: 1.2em; color: #34495e; font-weight: 500; margin-bottom: 25px;">
                ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏•‡∏á‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
            </p>
            <textarea id="userPrompt" placeholder="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£? ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡∏ö‡πâ‡∏≤‡∏á? (‡πÄ‡∏ä‡πà‡∏ô ‡∏â‡∏±‡∏ô‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏°‡∏î‡∏ï‡∏≠‡∏ô‡πÅ‡∏Å‡πà, ‡∏â‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î, ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏•‡∏¢)"></textarea>
            <button id="getTherapyCardButton">‡∏£‡∏±‡∏ö‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î</button>
        </div>

        <div class="therapy-result-section" id="resultArea">
            <p id="initialMessage">‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
            <div class="loading-spinner" style="display: none;"></div>
            
            <div class="therapy-card-display" style="display: none;">
                <img id="therapyCardImage" src="" alt="‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                <div id="therapyTextOverlay" class="therapy-text-overlay"></div>
            </div>
            
            <p id="errorMessage" class="error-message" style="display: none;"></p>
        </div>

        <div class="footer-cta">
            <p>‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÉ‡∏ö‡∏ô‡∏µ‡πâ "‡πÇ‡∏î‡∏ô‡πÉ‡∏à" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!</p>
            <a href="https://line.me/ti/p/@puchuaygoh" target="_blank" class="button">üí¨ ‡∏ô‡∏±‡∏î‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏û‡∏∏‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏Å‡πä‡∏∞ (‡∏ü‡∏£‡∏µ!)</a>
        </div>
    </div>

    <script type="module">
        
        // üìå (STEP 1: "‡πÄ‡∏£‡∏µ‡∏¢‡∏Å" (Import) "‡∏™‡∏°‡∏≠‡∏á AI" (AI Brain) "‡∏Å‡πà‡∏≠‡∏ô" (FIRST)!)
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // ---------------------------------------------------------------------------
        // *** üìåüìå (STEP 2: "‡πÉ‡∏™‡πà" (Insert) "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à" (Key) "‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" (HERE)) üìåüìå ***
        const GEMINI_API_KEY = "AIzaSyCmw6n3esCycDGeW0rGBuka3RPIdehMIxw"; 
        // ---------------------------------------------------------------------------

        // üìå (STEP 3: "‡πÄ‡∏ä‡πá‡∏Å" (Check) "‡∏Å‡∏∏‡∏ç‡πÅ‡∏à" (Key) ‡πÅ‡∏•‡∏∞ "‡∏™‡∏°‡∏≠‡∏á" (Brain))
        if (GEMINI_API_KEY === "‡πÉ‡∏™‡πà_Gemini_API_Key_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" || !GEMINI_API_KEY) {
            document.getElementById('errorMessage').textContent = "‚ö†Ô∏è Config Error: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Gemini API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('getTherapyCardButton').disabled = true;
            document.getElementById('initialMessage').style.display = 'none';
        
        // üìå (STEP 4: "‡∏ñ‡πâ‡∏≤" (IF) "‡∏™‡∏°‡∏≠‡∏á" (Brain) "‡πÇ‡∏´‡∏•‡∏î" (Loaded) "‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" (Failed))
        } else if (typeof GoogleGenerativeAI === 'undefined') {
            document.getElementById('errorMessage').textContent = "‚ö†Ô∏è Library Error: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Google Gemini SDK ‡πÑ‡∏î‡πâ (‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡πá‡∏Å Console ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä)";
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('getTherapyCardButton').disabled = true;
            document.getElementById('initialMessage').style.display = 'none';
        
        // üìå (STEP 5: "‡∏ñ‡πâ‡∏≤" (IF) "‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á" (Everything) "‡∏û‡∏£‡πâ‡∏≠‡∏°" (Ready)... "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" (Start working!))
        } else {
            
            // (‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°" (Same as before) ‡∏Ñ‡∏£‡∏±‡∏ö)
            
            const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-pro" });

            const userPromptTextarea = document.getElementById('userPrompt');
            const getTherapyCardButton = document.getElementById('getTherapyCardButton');
            const loadingSpinner = document.querySelector('.loading-spinner');
            const therapyCardDisplay = document.querySelector('.therapy-card-display');
            const therapyCardImage = document.getElementById('therapyCardImage');
            const therapyTextOverlay = document.getElementById('therapyTextOverlay');
            const errorMessage = document.getElementById('errorMessage');
            const initialMessage = document.getElementById('initialMessage');

            // (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤)
            const therapyCards = {
                "‡πÉ‡∏à‡∏™‡∏á‡∏ö": { image: "images/chef-guarantee-card.png", name: "‡πÑ‡∏û‡πà‡πÄ‡∏ä‡∏ü‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ" },
                "‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á": { image: "images/gym-3in1-card.png", name: "‡πÑ‡∏û‡πà‡∏¢‡∏¥‡∏° 3-in-1" },
                "‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à/‡∏•‡∏±‡∏á‡πÄ‡∏•": { image: "images/mirror-childhood-card.png", name: "‡πÑ‡∏û‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏ß‡∏±‡∏¢‡πÄ‡∏î‡πá‡∏Å" },
                "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á": { image: "images/chef-guarantee-card.png", name: "‡πÑ‡∏û‡πà‡πÄ‡∏ä‡∏ü‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ" },
                "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•": { image: "images/mirror-childhood-card.png", name: "‡πÑ‡∏û‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏ß‡∏±‡∏¢‡πÄ‡∏î‡πá‡∏Å" }
            };
            
            // (‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡∏±‡∏ö)
            const SYSTEM_INSTRUCTION = `
                ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏Å‡πä‡∏∞" ‡∏ô‡∏±‡∏Å‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ) ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÑ‡∏û‡πà‡∏ö‡∏≥‡∏ö‡∏±‡∏î/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
                
                ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö:
                1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏∏ "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏´‡∏•‡∏±‡∏Å" ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ: [‡πÉ‡∏à‡∏™‡∏á‡∏ö, ‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á, ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à/‡∏•‡∏±‡∏á‡πÄ‡∏•, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•]
                2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≥‡∏ö‡∏±‡∏î (therapy_message) ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3-4 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 70 ‡∏Ñ‡∏≥) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡∏Ç‡∏≠‡∏á '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏Å‡πä‡∏∞' ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ô‡∏±‡πâ‡∏ô

                ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á JSON
                `;

            getTherapyCardButton.addEventListener('click', async () => {
                const userPrompt = userPromptTextarea.value.trim();
                if (!userPrompt) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!');
                    return;
                }

                initialMessage.style.display = 'none';
                therapyCardDisplay.style.display = 'none';
                errorMessage.style.display = 'none';
                loadingSpinner.style.display = 'block';
                getTherapyCardButton.disabled = true;

                try {
                    const aiPrompt = `‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "${userPrompt}"`;
                    
                    const chat = model.startChat({
                        systemInstruction: {
                            role: "system",
                            parts: [{ text: SYSTEM_INSTRUCTION }],
                        },
                    });

                    const result = await chat.sendMessage(aiPrompt);
                    const response = result.response;
                    
                    // (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å "JSON")
                    let text = response.text();
                    // (‡∏Å‡∏±‡∏ô AI "‡πÄ‡∏ú‡∏•‡∏≠" (Accidentally) "‡πÉ‡∏™‡πà" (Add) "```json" (```json) "‡∏Ñ‡∏£‡∏≠‡∏ö" (Wrap) "‡∏°‡∏≤‡πÉ‡∏´‡πâ" (the response))
                    text = text.replace(/```json/g, "").replace(/```/g, "").trim(); 
                    
                    const aiResponse = JSON.parse(text); 
                    
                    const concernType = aiResponse.concern_type;
                    const therapyMessage = aiResponse.therapy_message;

                    let selectedCard = therapyCards[concernType] || therapyCards["‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à/‡∏•‡∏±‡∏á‡πÄ‡∏•"]; 

                    therapyCardImage.src = selectedCard.image;
                    
                    therapyTextOverlay.innerHTML = `
                        <p style="font-size: 1.2em; font-weight: 700; color: #34495e;">${selectedCard.name}</p>
                        <hr style="border-top: 1px solid #ccc; width: 60%; margin: 5px auto;">
                        <p style="font-size: 1.0em; color: #4CAF50;">${therapyMessage}</p>
                        <p style="font-size: 0.8em; margin-top: 10px; color: #d9534f;">‡πÑ‡∏û‡πà‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ AI</p>
                    `;
                    
                    loadingSpinner.style.display = 'none';
                    therapyCardDisplay.style.display = 'block';
                    resultArea.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    console.error("Error generating therapy card:", error);
                    errorMessage.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ): ${error.message || '‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'}`;
                    errorMessage.style.display = 'block';
                    loadingSpinner.style.display = 'none';
                } finally {
                    getTherapyCardButton.disabled = false;
                }
            });
        }
    </script>
</body>
</html>
